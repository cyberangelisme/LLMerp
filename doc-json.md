# LLM知识图谱生成指南

## 一、简介

本指南介绍如何使用大型语言模型(LLM)生成知识图谱，并通过转换工具将其转换为标准XML格式。我们使用简化的JSON作为中间格式，以减少LLM输出的冗余内容。

## 二、JSON格式说明

知识图谱的简化JSON格式包含两个主要部分：实体(entities)和关系(relations)：

```json
{
  "entities": [
    // 实体数组
  ],
  "relations": [
    // 关系数组
  ]
}
```

## 三、实体定义

每个实体包含4个必要属性：

```json
{
  "id": 1,                  // 唯一ID，整数，从1开始
  "class": "知识领域",       // 实体类型
  "content": "内容描述",     // 实体内容
  "attach": "100000"        // 六位数字编码
}
```

### 3.1 实体类型(class)

有4种实体类型，表示不同层级的知识：

| 实体类型 | 描述 | 通常用法 |
|---------|------|---------|
| 知识领域 | 顶层概念 | 用于表示主题或学科领域 |
| 知识单元 | 二级概念 | 表示主题下的主要模块或单元 |
| 知识点 | 具体知识点 | 表示单元中的关键概念 |
| 关键知识细节 | 最细节的知识 | 表示知识点的具体细节 |

### 3.2 attach编码规则

attach是一个六位数字编码，每位代表一种属性（1表示有，0表示无）：

- 第1位(T)：思维
- 第2位(Z)：思政
- 第3位(Q)：问题
- 第4位(K)：知识
- 第5位(E)：示例
- 第6位(P)：练习

例如：
- "100000" - 有思维属性
- "110000" - 有思维和思政属性
- "101010" - 有思维、问题和示例属性

## 四、关系定义

关系用于连接不同实体，每个关系包含3个属性：

```json
{
  "type": "包含",  // 关系类型："包含" 或 "次序"
  "head": 1,      // 起始节点ID
  "tail": 2       // 目标节点ID
}
```

### 4.1 关系类型

- **包含**：表示概念的层级包含关系，如主题包含子主题
- **次序**：表示知识点之间的顺序或前后依赖关系

## 五、如何提示LLM生成知识图谱

当使用LLM生成知识图谱时，可以使用如下提示模板：

```
请为[主题]创建一个知识图谱，以简化JSON格式输出。格式要求：
1. 实体包含id、class、content和attach属性
2. 实体class可选值为：知识领域、知识单元、知识点、关键知识细节
3. 关系包含type、head和tail属性
4. 关系type可选值为：包含、次序

示例格式：
{
  "entities": [
    {"id": 1, "class": "知识领域", "content": "主题名称", "attach": "100000"},
    {"id": 2, "class": "知识单元", "content": "子主题1", "attach": "110000"}
  ],
  "relations": [
    {"type": "包含", "head": 1, "tail": 2}
  ]
}

请确保：
- 实体ID从1开始且唯一
- 关系的head和tail必须引用已定义的实体ID
- attach编码为6位数字
```

## 六、示例：Transformer LLM结构知识图谱

以下是一个关于Transformer LLM结构的知识图谱JSON示例：

```json
{
  "entities": [
    {"id": 1, "class": "知识领域", "content": "Transformer LLM 结构", "attach": "100000"},
    {"id": 2, "class": "知识单元", "content": "输入处理", "attach": "110000"},
    {"id": 3, "class": "知识点", "content": "输入嵌入层", "attach": "101000"},
    {"id": 4, "class": "知识点", "content": "位置编码", "attach": "100100"},
    {"id": 5, "class": "知识单元", "content": "Transformer Block", "attach": "111000"},
    {"id": 6, "class": "知识点", "content": "多头自注意力机制", "attach": "110100"},
    {"id": 7, "class": "知识点", "content": "前馈神经网络", "attach": "101010"},
    {"id": 8, "class": "知识点", "content": "残差连接与层归一化", "attach": "100110"},
    {"id": 9, "class": "知识单元", "content": "输出处理", "attach": "111100"},
    {"id": 10, "class": "知识点", "content": "线性变换与Softmax", "attach": "101110"}
  ],
  "relations": [
    {"type": "包含", "head": 1, "tail": 2},
    {"type": "包含", "head": 1, "tail": 5},
    {"type": "包含", "head": 1, "tail": 9},
    {"type": "包含", "head": 2, "tail": 3},
    {"type": "包含", "head": 2, "tail": 4},
    {"type": "包含", "head": 5, "tail": 6},
    {"type": "包含", "head": 5, "tail": 7},
    {"type": "包含", "head": 5, "tail": 8},
    {"type": "次序", "head": 6, "tail": 7},
    {"type": "次序", "head": 7, "tail": 8},
    {"type": "包含", "head": 9, "tail": 10}
  ]
}
```

## 七、转换为标准XML

1. 将LLM生成的JSON保存为文件（例如`kg.json`）
2. 使用提供的转换脚本将JSON转换为标准XML：

```bash
python kg_converter.py kg.json -o kg.xml
```

转换脚本会自动：
- 根据class属性推导level属性
- 添加必要的固定属性（classification、identity等）
- 将坐标(x,y)设为0，以便软件自动排布
- 根据关系类型设置正确的class_name和classification

## 八、注意事项与最佳实践

1. **层级结构**：从知识领域到知识单元再到知识点，保持清晰的层级结构
2. **关系构建**：
   - 父节点应通过"包含"关系连接到子节点
   - 同级节点之间可以通过"次序"关系表示顺序关系
3. **ID规划**：按照逻辑顺序分配ID，便于后续编辑
4. **避免冗余**：不要创建冗余的实体或关系
5. **attach编码**：根据节点特性合理设置attach编码

## 九、高级提示技巧

对于复杂主题，可以指导LLM分步构建知识图谱：

1. 先确定顶层知识领域和主要知识单元
2. 对每个知识单元展开，定义其包含的知识点
3. 如有必要，进一步细化为关键知识细节
4. 最后添加关系，先定义包含关系，再补充次序关系

## 十、结语

本方法通过简化的JSON格式，大大减少了LLM生成知识图谱的输出长度，同时通过转换脚本确保最终XML符合标准要求。对于教学知识图谱的构建，这是一种高效且实用的方法。
